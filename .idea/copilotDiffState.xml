<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/database/create-database-mysql.sql">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/database/create-database-mysql.sql" />
              <option name="originalContent" value="-- MySQL Database Schema for Raffles Manager&#10;-- Mode: MySQL&#10;&#10;DROP DATABASE IF EXISTS raffles;&#10;CREATE DATABASE raffles;&#10;USE raffles;&#10;&#10;CREATE TABLE proyects (&#10;    id INT AUTO_INCREMENT PRIMARY KEY,&#10;    name VARCHAR(100) NOT NULL,&#10;    description TEXT,&#10;    creation_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP,&#10;    isActive BOOLEAN DEFAULT true&#10;);&#10;&#10;CREATE TABLE rafflesSet (&#10;    id INT AUTO_INCREMENT PRIMARY KEY,&#10;    proyect_id INTEGER,&#10;    name VARCHAR(100) NOT NULL,&#10;    type VARCHAR(8) NOT NULL CHECK (type IN ('online', 'physical')),&#10;    init INTEGER NOT NULL,&#10;    final INTEGER NOT NULL,&#10;    unit_price INTEGER NOT NULL,&#10;    creation_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP,&#10;    CONSTRAINT valid_numbers CHECK (init &lt; final),&#10;    CONSTRAINT unique_set UNIQUE (proyect_id, name),&#10;    FOREIGN KEY (proyect_id) REFERENCES proyects(id)&#10;);&#10;&#10;CREATE TABLE buyers (&#10;    id INT AUTO_INCREMENT PRIMARY KEY,&#10;    name VARCHAR(100) NOT NULL,&#10;    email VARCHAR(100) UNIQUE NOT NULL,&#10;    phone VARCHAR(20),&#10;    register_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP&#10;);&#10;&#10;CREATE TABLE raffles (&#10;    set_id INTEGER NOT NULL,&#10;    number INTEGER NOT NULL,&#10;    sell_date TIMESTAMP,&#10;    buyer_id INTEGER,&#10;    payment_method VARCHAR(50) CHECK (payment_method in ('CASH', 'CARD', 'TRANSFER', 'OTHER')),&#10;    state VARCHAR(20) DEFAULT 'available' CHECK (state IN ('available', 'sold', 'reserved')),&#10;    FOREIGN KEY (buyer_id) REFERENCES buyers(id),&#10;    FOREIGN KEY (set_id) REFERENCES rafflesSet(id),&#10;    PRIMARY KEY (set_id, number),&#10;    UNIQUE KEY unique_number (number)&#10;);&#10;&#10;-- Trigger to generate raffle numbers when a new raffleSet is created&#10;DELIMITER //&#10;CREATE TRIGGER generate_raffles&#10;    AFTER INSERT ON rafflesSet&#10;    FOR EACH ROW&#10;BEGIN&#10;    DECLARE i INT DEFAULT NEW.init;&#10;    WHILE i &lt;= NEW.final DO&#10;        INSERT INTO raffles (set_id, number) VALUES (NEW.id, i);&#10;        SET i = i + 1;&#10;    END WHILE;&#10;END//&#10;DELIMITER ;&#10;" />
              <option name="updatedContent" value="-- MySQL Database Schema for Raffles Manager&#10;-- Mode: MySQL&#10;&#10;DROP DATABASE IF EXISTS raffles;&#10;CREATE DATABASE raffles;&#10;USE raffles;&#10;&#10;CREATE TABLE proyects (&#10;    id INT AUTO_INCREMENT PRIMARY KEY,&#10;    name VARCHAR(100) NOT NULL,&#10;    description TEXT,&#10;    creation_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP,&#10;    isActive BOOLEAN DEFAULT true&#10;);&#10;&#10;CREATE TABLE rafflesSet (&#10;    id INT AUTO_INCREMENT PRIMARY KEY,&#10;    proyect_id INTEGER,&#10;    name VARCHAR(100) NOT NULL,&#10;    type VARCHAR(8) NOT NULL CHECK (type IN ('online', 'physical')),&#10;    init INTEGER NOT NULL,&#10;    final INTEGER NOT NULL,&#10;    unit_price INTEGER NOT NULL,&#10;    creation_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP,&#10;    CONSTRAINT valid_numbers CHECK (init &lt; final),&#10;    CONSTRAINT unique_set UNIQUE (proyect_id, name),&#10;    FOREIGN KEY (proyect_id) REFERENCES proyects(id)&#10;);&#10;&#10;CREATE TABLE buyers (&#10;    id INT AUTO_INCREMENT PRIMARY KEY,&#10;    name VARCHAR(100) NOT NULL,&#10;    email VARCHAR(100) UNIQUE NOT NULL,&#10;    phone VARCHAR(20),&#10;    register_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP&#10;);&#10;&#10;CREATE TABLE raffles (&#10;    set_id INTEGER NOT NULL,&#10;    number INTEGER NOT NULL,&#10;    sell_date TIMESTAMP,&#10;    buyer_id INTEGER,&#10;    payment_method VARCHAR(50) CHECK (payment_method in ('CASH', 'CARD', 'TRANSFER', 'OTHER')),&#10;    state VARCHAR(20) DEFAULT 'available' CHECK (state IN ('available', 'sold', 'reserved')),&#10;    FOREIGN KEY (buyer_id) REFERENCES buyers(id),&#10;    FOREIGN KEY (set_id) REFERENCES rafflesSet(id),&#10;    PRIMARY KEY (set_id, number),&#10;    UNIQUE KEY unique_number (number)&#10;);&#10;&#10;DELIMITER //&#10;CREATE TRIGGER generate_raffles&#10;    AFTER INSERT ON rafflesSet&#10;    FOR EACH ROW&#10;BEGIN&#10;    DECLARE i INT DEFAULT NEW.init;&#10;    WHILE i &lt;= NEW.final DO&#10;        INSERT INTO raffles (set_id, number) VALUES (NEW.id, i);&#10;        SET i = i + 1;&#10;    END WHILE;&#10;END//&#10;DELIMITER ;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/database/create-database.mysql">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/database/create-database.mysql" />
              <option name="originalContent" value="-- @dialect mariadb&#10;&#10;DROP DATABASE raffles IF EXISTS;&#10;CREATE DATABASE raffles;&#10;USE raffles;&#10;&#10;CREATE TABLE proyects (&#10;    id INT AUTO_INCREMENT PRIMARY KEY,&#10;    name VARCHAR(100) NOT NULL,&#10;    description TEXT,&#10;    creation_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP,&#10;    isActive BOOLEAN DEFAULT true&#10;);&#10;&#10;CREATE TABLE rafflesSet (&#10;    id INT AUTO_INCREMENT PRIMARY KEY,&#10;    proyect_id INTEGER,&#10;    name VARCHAR(100) NOT NULL,&#10;    type VARCHAR(8) NOT NULL CHECK (type IN ('online', 'physical')),&#10;    init INTEGER NOT NULL,&#10;    final INTEGER NOT NULL,&#10;    unit_price INTEGER NOT NULL,&#10;    creation_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP,&#10;    CONSTRAINT valid_numbers CHECK (init &lt; final),&#10;    CONSTRAINT unique_set UNIQUE (proyect_id, name),&#10;    FOREIGN KEY (proyect_id) REFERENCES proyects(id)&#10;);&#10;&#10;CREATE TABLE buyers (&#10;    id INT AUTO_INCREMENT PRIMARY KEY,&#10;    name VARCHAR(100) NOT NULL,&#10;    email VARCHAR(100) UNIQUE NOT NULL,&#10;    phone VARCHAR(20),&#10;    register_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP&#10;);&#10;&#10;CREATE TABLE raffles (&#10;    set_id INTEGER NOT NULL,&#10;    number INTEGER NOT NULL,&#10;    sell_date TIMESTAMP,&#10;    buyer_id INTEGER,&#10;    payment_method VARCHAR(50) CHECK (payment_method in ('CASH', 'CARD', 'TRANSFER', 'OTHER')),&#10;    state VARCHAR(20) DEFAULT 'available' CHECK (state IN ('available', 'sold', 'reserved')),&#10;    FOREIGN KEY (buyer_id) REFERENCES buyers(id),&#10;    FOREIGN KEY (set_id) REFERENCES rafflesSet(id),&#10;    PRIMARY KEY (set_id, number),&#10;    UNIQUE KEY unique_number (number)&#10;);" />
              <option name="updatedContent" value="DROP DATABASE IF EXISTS raffles;&#10;CREATE DATABASE raffles;&#10;USE raffles;&#10;&#10;CREATE TABLE proyects (&#10;    id INT AUTO_INCREMENT PRIMARY KEY,&#10;    name VARCHAR(100) NOT NULL,&#10;    description TEXT,&#10;    creation_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP,&#10;    isActive BOOLEAN DEFAULT true&#10;);&#10;&#10;CREATE TABLE rafflesSet (&#10;    id INT AUTO_INCREMENT PRIMARY KEY,&#10;    proyect_id INTEGER,&#10;    name VARCHAR(100) NOT NULL,&#10;    type VARCHAR(8) NOT NULL CHECK (type IN ('online', 'physical')),&#10;    init INTEGER NOT NULL,&#10;    final INTEGER NOT NULL,&#10;    unit_price INTEGER NOT NULL,&#10;    creation_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP,&#10;    CONSTRAINT valid_numbers CHECK (init &lt; final),&#10;    CONSTRAINT unique_set UNIQUE (proyect_id, name),&#10;    FOREIGN KEY (proyect_id) REFERENCES proyects(id)&#10;);&#10;&#10;CREATE TABLE buyers (&#10;    id INT AUTO_INCREMENT PRIMARY KEY,&#10;    name VARCHAR(100) NOT NULL,&#10;    email VARCHAR(100) UNIQUE NOT NULL,&#10;    phone VARCHAR(20),&#10;    register_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP&#10;);&#10;&#10;CREATE TABLE raffles (&#10;    set_id INTEGER NOT NULL,&#10;    number INTEGER NOT NULL,&#10;    sell_date TIMESTAMP,&#10;    buyer_id INTEGER,&#10;    payment_method VARCHAR(50) CHECK (payment_method in ('CASH', 'CARD', 'TRANSFER', 'OTHER')),&#10;    state VARCHAR(20) DEFAULT 'available' CHECK (state IN ('available', 'sold', 'reserved')),&#10;    FOREIGN KEY (buyer_id) REFERENCES buyers(id),&#10;    FOREIGN KEY (set_id) REFERENCES rafflesSet(id),&#10;    PRIMARY KEY (set_id, number),&#10;    UNIQUE KEY unique_number (number)&#10;);&#10;&#10;-- Trigger to generate raffle numbers when a new raffleSet is created&#10;DELIMITER //&#10;CREATE TRIGGER generate_raffles&#10;    AFTER INSERT ON rafflesSet&#10;    FOR EACH ROW&#10;BEGIN&#10;    DECLARE i INT DEFAULT NEW.init;&#10;    WHILE i &lt;= NEW.final DO&#10;        INSERT INTO raffles (set_id, number) VALUES (NEW.id, i);&#10;        SET i = i + 1;&#10;    END WHILE;&#10;END//&#10;DELIMITER ;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/database/test_database.py">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/database/test_database.py" />
              <option name="updatedContent" value="#!/usr/bin/env python3&#10;        print(&quot;âŒ Some tests failed. Please check the database setup.&quot;)&#10;        sys.exit(1)&#10;&#10;if __name__ == &quot;__main__&quot;:&#10;    main()" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="/tmp/create-database-fixed.sql">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="/tmp/create-database-fixed.sql" />
              <option name="updatedContent" value="CREATE SCHEMA IF NOT EXISTS raffles_schema;&#10;&#10;SET search_path TO raffles_schema, public;&#10;&#10;CREATE TABLE proyects (&#10;    id SERIAL PRIMARY KEY,&#10;    name VARCHAR(100) NOT NULL,&#10;    description TEXT,&#10;    creation_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP,&#10;    isActive BOOL DEFAULT true&#10;);&#10;&#10;CREATE TABLE rafflesSet (&#10;    id SERIAL PRIMARY KEY,&#10;    proyect_id INTEGER REFERENCES proyects(id),&#10;    name VARCHAR(100) NOT NULL,&#10;    type VARCHAR(8) NOT NULL CHECK (type IN ('online', 'physical')),&#10;    init INTEGER NOT NULL,&#10;    final INTEGER NOT NULL,&#10;    unit_price INTEGER NOT NULL ,&#10;    creation_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP,&#10;    CONSTRAINT valid_numbers CHECK (init &lt; final),&#10;    CONSTRAINT unique_set UNIQUE (proyect_id, name)&#10;);&#10;&#10;CREATE TABLE buyers (&#10;    id SERIAL PRIMARY KEY,&#10;    name VARCHAR(100) NOT NULL,&#10;    email VARCHAR(100) UNIQUE NOT NULL,&#10;    phone VARCHAR(20),&#10;    register_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP&#10;);&#10;&#10;CREATE TABLE raffles ( -- Units&#10;    set_id INTEGER NOT NULL REFERENCES rafflesSet(id),&#10;    number INTEGER NOT NULL,&#10;    sell_date TIMESTAMP,&#10;    buyer_id INTEGER,&#10;    payment_method VARCHAR(50) CHECK (payment_method in ('CASH', 'CARD', 'TRANSFER', 'OTHER')),&#10;    state VARCHAR(20) DEFAULT 'available' CHECK (state IN ('available', 'sold', 'reserved')),&#10;    FOREIGN KEY (buyer_id) REFERENCES buyers(id),&#10;    PRIMARY KEY (set_id, number)&#10;);&#10;&#10;CREATE OR REPLACE FUNCTION generate_raffles()&#10;RETURNS TRIGGER AS $$&#10;DECLARE&#10;    next_number INTEGER;&#10;    count_numbers INTEGER;&#10;BEGIN&#10;&#10;    SELECT COALESCE(MAX(number), 0) + 1 INTO next_number FROM raffles;&#10;&#10;    -- Calculate how many numbers we need to generate&#10;    count_numbers := NEW.final - NEW.init + 1;&#10;&#10;    -- Update the rafflesSet with the actual init and final values&#10;    UPDATE rafflesSet&#10;    SET init = next_number,&#10;        final = next_number + count_numbers - 1&#10;    WHERE id = NEW.id;&#10;&#10;    -- Insert the raffle numbers&#10;    INSERT INTO raffles (set_id, number)&#10;    SELECT NEW.id, generate_series(next_number, next_number + count_numbers - 1);&#10;&#10;    RETURN NEW;&#10;END;&#10;$$ LANGUAGE plpgsql;&#10;&#10;CREATE TRIGGER trig_generate_raffles&#10;AFTER INSERT ON rafflesSet&#10;FOR EACH ROW&#10;EXECUTE FUNCTION generate_raffles();" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>